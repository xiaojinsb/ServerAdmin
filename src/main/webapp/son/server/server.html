<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>系统管理</title>
    <link rel="stylesheet" href="../../statics/plugins/layui/css/layui.css" media="all">
    <style>
        .layui-form-label{width: 100px}
        .layui-input-block{margin-left: 130px}
    </style>
</head>
<body>

<form name="searchform" id="searchform" class="layui-form layui-form-pane" method="post" action="" style="margin: 15px 0px 0px 10px">
    <!--搜索组-->
    <div class="layui-form-item" style="margin-bottom: 5px">
        <div class="layui-inline">
            <label class="layui-form-label" style="width: 90px">用户名</label>
            <div class="layui-input-inline">
                <input type="text" name="username" placeholder="请输入用户名" maxlength="50" autocomplete="off" class="layui-input" />
            </div>
        </div>
        <!-- 按钮组 -->
        <button class="layui-btn layui-btn-normal" lay-filter="btnSearch" type="button"  lay-submit>搜索</button>
        <button type="reset" id="btnRetSet" type="button" class="layui-btn layui-btn-primary">重置</button>
    </div>

</form>

<div style="margin-left: 10px">
    <button class="layui-btn" id="add" type="button">
        <i class="layui-icon">&#xe654;</i>
        添加
    </button>
</div>

<table id="tableList" lay-filter="tableList"></table>

<!--操作工具栏-->
<script type="text/html" id="operationTpl">
    <button class="layui-btn layui-btn-sm" lay-event="edit"><i class="layui-icon">&#xe642;</i>编辑</button>
    <button class="layui-btn layui-btn-sm  layui-btn-danger" lay-event="delete"><i class="layui-icon">&#xe640;</i>删除</button>
</script>

<!--查看信息 绑定在用户名字-->
<script type="text/html" id="lookTpl">
    <a href="javascript:;" class="layui-table-link" lay-event="look">{{ d.serverName }}</a>
</script>

<!--添加-->
<div id="addTpl" style="display: none;background-color: #F2F2F2;width: 100%;padding-bottom: 20px">
    <form class="layui-form" method="post" style="padding-top: 20px">

        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">

                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-header">服务器基本信息</div>
                        <div class="layui-card-body layui-row layui-col-space10">
                            <div class="layui-col-lg3">
                                <label class="layui-form-label">服务器名称<span class="remind">*</span>：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="serverName" lay-verify="serverName" placeholder="请输入服务器名称" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg3">
                                <label class="layui-form-label">设备类型：</label>
                                <div class="layui-input-block">
                                    <select name="type" lay-verify="type" lay-filter="type">
                                        <option value=""></option>
                                        <option value="物理机">物理机</option>
                                        <option value="虚拟机">虚拟机</option>
                                        <option value="储存">储存</option>
                                        <option value="网络">网络设备</option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-col-lg3">
                                <label class="layui-form-label">网络情况：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="serNet" lay-verify="serNet" placeholder="请输入服务器网络情况" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg3">
                                <label class="layui-form-label">部署情况：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="depSituation" lay-verify="depSituation" placeholder="请输入服务器部署情况" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-col-md6">

                    <div class="layui-card">
                        <div class="layui-card-header">服务器软件信息</div>
                        <div class="layui-card-body layui-row layui-col-space10">
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">计算机名称：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="pcName" lay-verify="pcName" placeholder="请输入计算机名称" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">运维人员：</label>
                                <div class="layui-input-block">
                                    <select name="userName" lay-verify="userName" id="userName">
                                        <option value=""></option>
                                    </select>
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">ip地址：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="serverIp" lay-verify="serverIp" placeholder="请输入IP地址" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">管理口地址：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="managementPort" lay-verify="managementPort" placeholder="请输入管理口(物理机)地址" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">管理账号<span class="remind">*</span>：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="serverAdmin" lay-verify="serverAdmin" placeholder="请输入系统管理账号" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">管理密码<span class="remind">*</span>：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="serverPas" lay-verify="serverPas" placeholder="请输入系统管理账号密码" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">操作系统<span class="remind">*</span>：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="os" lay-verify="os" placeholder="请输入操作系统名称" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">杀毒软件：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="shaduSoft" lay-verify="shaduSoft" placeholder="请输入杀毒软件和安装目录" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg12">
                                <label class="layui-form-label">系统初始配置：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="beginConfig" lay-verify="beginConfig" placeholder="请输入系统初始配置" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="layui-card">
                        <div class="layui-card-header">备注</div>
                        <div class="layui-card-body layui-row layui-col-space10">
                            <div class="layui-col-md12">
                                <textarea name="serverContent" lay-verify="serverContent" placeholder="请输入备注" class="layui-textarea"></textarea>
                            </div>
                        </div>
                    </div>


                </div>
                <div class="layui-col-md6">

                    <div class="layui-card">
                        <div class="layui-card-header">服务器硬件信息(物理机填写)</div>
                        <div class="layui-card-body layui-row layui-col-space10">
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">设备型号：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="model" lay-verify="model" placeholder="请输入设备型号" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">机房位置：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="generator" lay-verify="generator" placeholder="请输入机房所在位置" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">楼层房间号：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="houseHumber" lay-verify="houseHumber" placeholder="请输入楼层房间号" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">机柜：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="cabinet" lay-verify="cabinet" placeholder="请输入机柜名称" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">机柜位置编号：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="cabinetHumber" lay-verify="cabinetHumber" placeholder="请输入机柜位置编号" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">设备资产编号：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="propertyNumber" lay-verify="propertyNumber" placeholder="请输入设备资产编号" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">设备购买时间：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="equipmentBuyTime" lay-verify="equipmentBuyTime" id="equipmentBuyTime" placeholder="请选择设备购买时间" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">设备使用年限：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="equipmentAgeLimit" lay-verify="equipmentAgeLimit" placeholder="请输入设备使用年限" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-col-lg6">
                                <label class="layui-form-label">领料人：</label>
                                <div class="layui-input-block">
                                    <input type="text" name="leader" lay-verify="leader" placeholder="请输入领料人" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="layui-card">
                        <div class="layui-card-header">硬件主要配置	</div>
                        <div class="layui-card-body layui-row layui-col-space10">
                            <div class="layui-col-md12">
                                <textarea name="hardwareConfiguration" lay-verify="hardwareConfiguration" placeholder="请输入硬件主要配置(cpu, 内存, 硬盘等)" class="layui-textarea"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <button class="layui-btn" lay-submit lay-filter="submitSave" style="display: none;">保存</button>
        <button type="reset" class="layui-btn layui-btn-primary" lay-filter="render" style="display: none;">重置</button>
    </form>

    <div class="layui-fluid lookOthers" style="margin-top: 20px;display: none">
        <div class="layui-row layui-col-space15">

            <div class="layui-col-md12">
                <div class="layui-card">
                    <div class="layui-card-header">此服务器具有的应用</div>
                    <div class="layui-card-body layui-row layui-col-space10">

                        <div>
                            <blockquote class="layui-elem-quote quoteBox">
                                <span>应用系统</span>
                            </blockquote>
                            <table id="sysList" lay-filter="sysList"></table>
                            <blockquote class="layui-elem-quote quoteBox">
                                <span>数据库</span>
                            </blockquote>
                            <table id="dataList" lay-filter="dataList"></table>
                            <blockquote class="layui-elem-quote quoteBox">
                                <span>中间件</span>
                            </blockquote>
                            <table id="middList" lay-filter="middList"></table>
                        </div>

                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<script src="../../statics/plugins/layui/layui.js"></script>
<script>
    layui.use(['table', 'form', 'laydate'], function () {
        var table = layui.table, //获取表格
            form = layui.form, //获取from
            $ = layui.jquery, //获取jq
            laydate = layui.laydate; //获取时间插件

        //渲染表格
        var tablelist = table.render({
            id: 'table'
            , elem: '#tableList' //选择表单
            , url: '../../server/list' //json返回地址
            , page: true //分页 开启
            // , height: 'full-125' // 高度 距离底部
            , cols: [ //表头 //sort 是否开启排序 //fixed 开启操作是否悬浮
                [
                    {type: 'checkbox', fixed: "left"}
                    , {field: 'serverId', title: 'id', align: 'center', sort: true, width: 70}
                    , {field: 'serverName', title: '服务器名称', toolbar: '#lookTpl', align: 'center', width: 130}
                    , {field: 'serNet', title: '网络情况', align: 'center', width: '100',}
                    , {field: 'depSituation', title: '部署情况', align: 'center', width: '100',}
                    , {field: 'type', title: '设备类型', align: 'center', width: '100',}
                    , {field: 'userName', title: '运维人员', align: 'center', width: '100',}
                    , {field: 'serverIp', title: 'ip地址', align: 'center', width: '100',}
                    , {field: 'serverAdmin', title: '管理账号', align: 'center', width: '100',}
                    , {field: 'serverPas', title: '管理密码', align: 'center', width: '100',}

                    , {field: 'os', title: '操作系统', align: 'center', width: '100',}
                    , {field: 'pcName', title: '计算机名称', align: 'center', width: '100',}
                    , {field: 'shaduSoft', title: '杀毒软件', align: 'center', width: '100',}
                    , {field: 'beginConfig', title: '系统初始配置', align: 'center', width: '100',}

                    , {field: 'model', title: '设备编号', align: 'center', width: '100',}
                    , {field: 'generator', title: '机房位置', align: 'center', width: '100',}
                    , {field: 'houseHumber', title: '楼层房间号', align: 'center', width: '100',}
                    , {field: 'cabinetHumber', title: '机柜位置编号', align: 'center', width: '100',}
                    , {field: 'cabinet', title: '机柜', align: 'center', width: '100',}
                    , {field: 'propertyNumber', title: '设备资产编号', align: 'center', width: '100',}
                    , {field: 'equipmentBuyTime', title: '设备购买时间', align: 'center', width: '150',}
                    , {field: 'equipmentAgeLimit', title: '设备年限', align: 'center', width: '100',}
                    , {field: 'leader', title: '设备领料人', align: 'center', width: '100',}

                    , {field: 'serverContent', title: '备注相关信息', align: 'center', width: '100',}
                    , {field: 'hardwareConfiguration', title: '硬件配置', align: 'center', width: '100',}
                    , {field: 'createTime', title: '创建时间', align: 'center', width: '150',}
                    , {field: 'updateTime', title: '更新时间', align: 'center', width: '150',}
                    , {title: '操作', toolbar: '#operationTpl', fixed: "right", width: 200}
                ]
            ]
        });

        //查询
        form.on('submit(btnSearch)', function (data) {
            table.reload('table', {
                where: { //设定异步数据接口的额外参数
                    username: data.field.username
                }
                , page: {
                    curr: 1 //重新从第 1 页开始
                }
            });
            return false;
        });

        $("#add").click(function () {

            layer.open({
                title: '新增服务器' //窗口名
                , type: 1 //打开类型
                , shade: 0.4  //遮罩 浓度0.4
                , maxmin: true  //最小化开关 开
                , content: $('#addTpl')  //打开div模版
                , area: ['99%', '99%']  //弹出窗口大小 宽 高
                , btn: ['保存', '取消']  // 低部按钮
                , yes: function (index) { //确定按钮回调
                    //触发表单的提交事件
                    $('form.layui-form').find('button[lay-filter=submitSave]').click();
                },
                success: function (layero, index) { //层弹出后的成功回调
                    //弹出窗口成功后渲染表单
                    form.on('submit(submitSave)', function (data) {
                        $.post("../../server/add", data.field, function (res) {

                            if (res.msg == 'success') {
                                layer.msg('添加服务器成功');

                                layer.close(index); //关闭当前窗口
                                tablelist.reload(); //刷新
                            } else {
                                if (res.msg != null) {
                                    layer.msg(res.msg);
                                } else {
                                    layer.msg('添加服务器失败');
                                }
                            }

                        });
                        return false; //阻止表单跳转
                    });
                },
                end: function () {
                    $('form.layui-form').find('button[lay-filter=render]').click();
                }
            });
        });

        //监听操作条
        table.on('tool(tableList)', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值
            var tr = obj.tr; //获得当前行 tr 的DOM对象

            if (layEvent === 'look') {//查看

                //赋值
                for (var key in data) {
                    $("[name='"+key+"']").val(data[key]);
                    $("[name='"+key+"']").attr("disabled",true);
                }
                form.render('select');

                //显示 查询到的 存在于本服务器的 应用 数据库 中间件
                $(".lookOthers").show();
                look();

                layer.open({
                    title: '查看服务器信息'//窗口名
                    ,type: 1 //打开类型
                    ,shade: 0.4//遮罩 浓度0.4
                    ,maxmin: true //最小化开关 开
                    ,content: $('#addTpl') //打开div模版
                    , area: ['99%', '99%']  //弹出窗口大小 宽 高
                    , btn: ['关闭']  // 低部按钮
                    , end: function () {
                        $('form.layui-form').find('button[lay-filter=render]').click();
                        for (var key in data) {
                            $("[name='"+key+"']").attr("disabled",false);
                        }
                        $(".lookOthers").hide();
                        tablelist.reload(); //刷新
                    }
                });
            } else if (layEvent === 'edit') {//修改
                //赋值
                for (var key in data) {
                    $("[name='"+key+"']").val(data[key]);
                }
                form.render('select');
                var serverId = data.serverId;

                layer.open({
                    title: '修改服务器'//窗口名
                    ,type: 1 //打开类型
                    ,shade: 0.4//遮罩 浓度0.4
                    ,maxmin: true //最小化开关 开
                    ,content: $('#addTpl') //打开div模版
                    , area: ['99%', '99%']  //弹出窗口大小 宽 高
                    , btn: ['保存', '取消']  // 低部按钮
                    , yes: function (index) { //确定按钮回调
                        //触发表单的提交事件
                        $('form.layui-form').find('button[lay-filter=submitSave]').click();
                    },
                    success: function (layero, index) {
                        form.on('submit(submitSave)', function(data){
                            data.field.serverId = serverId;
                            $.post("../../server/edit", data.field, function (res) {

                                if (res.msg == 'success') {
                                    layer.msg('修改成功');

                                    layer.close(index); //关闭当前窗口
                                    tablelist.reload(); //刷新
                                } else {
                                    if (res.msg != null) {
                                        layer.msg(res.msg);
                                    } else {
                                        layer.msg('修改失败');
                                    }
                                }

                            });
                            return false; //阻止表单跳转
                        });
                    },
                    end: function () {
                        $('form.layui-form').find('button[lay-filter=render]').click();
                    }
                });
            }else if (layEvent === 'delete') {//删除
                layer.confirm('确定删除模块？', {
                    btn: ['确认', '关闭'] //按钮
                }, function () {
                    $.post("../../server/delete", {id: data.serverId}, function (res) {

                        if (res.msg == 'success') {
                            layer.msg('删除服务器成功');

                            tablelist.reload(); //刷新
                        } else {
                            if (res.msg != null) {
                                layer.msg(res.msg);
                            } else {
                                layer.msg('删除服务器失败');
                            }
                        }

                    });
                });
            }
        });

        //表单验证
        // form.verify({
        //     username: function(value, item){ //value：表单的值、item：表单的DOM对象
        //         if(!new RegExp("^[a-zA-Z0-9_\u4e00-\u9fa5\\s·]+$").test(value)){
        //             return '用户名不能有特殊字符';
        //         }
        //         if(/(^\_)|(\__)|(\_+$)/.test(value)){
        //             return '用户名首尾不能出现下划线\'_\'';
        //         }
        //         if(/^\d+\d+\d$/.test(value)){
        //             return '用户名不能全为数字';
        //         }
        //     },password: [
        //         /^[\S]{6,12}$/,'密码必须6到12位，且不能出现空格'
        //     ]
        // });

        //开启时间选择
        laydate.render({
            elem: '#equipmentBuyTime'
        });

        //请求获取用户列表
        $.ajax({
            type: "GET",
            url: '../../user/queryAllUser',
            contentType: "application/json",
            async: false,
            dataType: "json",
            success: function (data) {
                var html = "";
                for (var i =0; i < data.length;i++){
                    html += '<option value="'+data[i].username+'">'+data[i].username+'</option>';
                }
                $("#userName").append(html);
                form.render('select');
            },
            error: function () {
                alert("系统错误");
            }
        });
        
        function look() {
            table.render({
                id: 'table'
                , elem: '#sysList' //选择表单
                , url: '../../sys/list' //json返回地址
                , page: true //分页 开启
                // , height: 'full-125' // 高度 距离底部
                , cols: [ //表头 //sort 是否开启排序 //fixed 开启操作是否悬浮
                    [
                        {field: 'systemName', title: '应用系统名称', align: 'center', width: 130, style: 'background-color: #eee;'}
                        , {field: 'systemIp', title: 'ip地址', align: 'center', width: 100}
                        , {field: 'systemDomain', title: '访问域名', align: 'center', width: 100}
                        , {field: 'systemUrl', title: '管理地址', align: 'center', width: 100}
                        , {field: 'systemAdmin', title: '管理账号', align: 'center', width: 100}
                        , {field: 'systemPas', title: '管理密码', align: 'center', width: 100}
                        , {field: 'systemDeployment', title: '部署情况', align: 'center', width: 100}
                        , {field: 'userId', title: '运维人员', align: 'center', width: 100}
                        , {field: 'dbId', title: '数据库', align: 'center', width: 100}
                        , {field: 'middlewareId', title: '中间件', align: 'center', width: 100}
                        , {field: 'createTime', title: '创建时间', align: 'center', width: 100}
                        , {field: 'updateTime', title: '更新时间', align: 'center', width: 100}
                    ]
                ]
                , page: false
            });

            table.render({
                id: 'table'
                , elem: '#dataList' //选择表单
                , url: '../../data/list' //json返回地址
                , page: true //分页 开启
                // , height: 'full-125' // 高度 距离底部
                , cols: [ //表头 //sort 是否开启排序 //fixed 开启操作是否悬浮
                    [
                        {field: 'dbName', title: '数据库名称', align: 'center', width: 130, style: 'background-color: #eee;'}
                        , {field: 'dbType', title: '类型', align: 'center', width: 100}
                        , {field: 'dbAdmin', title: '管理员账号', align: 'center', width: 100}
                        , {field: 'dbPas', title: '管理密码', align: 'center', width: 100}
                        , {field: 'dbAddress', title: '安装路径', align: 'center', width: 100}
                        , {field: 'dbTool', title: '连接工具', align: 'center', width: 100}
                        , {field: 'dbContent', title: '备注', align: 'center', width: 100}
                        , {field: 'userId', title: '运维运维', align: 'center', width: 100}
                        , {field: 'createTime', title: '创建时间', align: 'center', width: 100}
                        , {field: 'updateTime', title: '更新时间', align: 'center', width: 100}
                    ]
                ]
                , page: false
            });

            table.render({
                id: 'table'
                , elem: '#middList' //选择表单
                , url: '../../midd/list' //json返回地址
                , page: true //分页 开启
                // , height: 'full-125' // 高度 距离底部
                , cols: [ //表头 //sort 是否开启排序 //fixed 开启操作是否悬浮
                    [
                        {field: 'middlewareName', title: '中间件名称', align: 'center', width: 130, style: 'background-color: #eee;'}
                        , {field: 'middlewareEdition', title: '中间件版本', align: 'center', width: 100}
                        , {field: 'middlewareUrl', title: '管理地址', align: 'center', width: 100}
                        , {field: 'middlewareAdmin', title: '管理账号', align: 'center', width: 100}
                        , {field: 'middlewarePas', title: '管理密码', align: 'center', width: 100}
                        , {field: 'middlewareMedium', title: '介质位置', align: 'center', width: 100}
                        , {field: 'middlewareContent', title: '备注信息', align: 'center', width: 100}
                        , {field: 'userId', title: '运维人员', align: 'center', width: 100}
                        , {field: 'createTime', title: '创建时间', align: 'center', width: 100}
                        , {field: 'updateTime', title: '更新时间', align: 'center', width: 100}
                    ]
                ]
                , page: false
            });
        }


        //解决ie兼容问题
        if (!!window.ActiveXObject || "ActiveXObject" in window) {
            // get缓存问题 关闭ajax 缓存
            $.ajaxSetup({cache: false})
            iePlaceholder();
        }

        //判断浏览器是否支持placeholder属性
        function iePlaceholder() {
            supportPlaceholder = 'placeholder' in document.createElement('input'),

                placeholder = function (input) {

                    var text = input.attr('placeholder'),
                        defaultValue = input.defaultValue;

                    if (!defaultValue) {
                        input.val(text).addClass("phcolor");
                    }

                    input.focus(function () {

                        if (input.val() == text) {
                            $(this).val("");
                        }
                    });

                    input.blur(function () {

                        if (input.val() == "") {
                            $(this).val(text).addClass("phcolor");
                        }
                    });

                    //输入的字符不为灰色
                    input.keydown(function () {
                        $(this).removeClass("phcolor");
                    });
                };

            //当浏览器不支持placeholder属性时，调用placeholder函数
            if (!supportPlaceholder) {

                $('input').each(function () {

                    text = $(this).attr("placeholder");

                    if ($(this).attr("type") == "text") {

                        placeholder($(this));
                    }
                });
            }
        }
    });
</script>
</body>
</html>